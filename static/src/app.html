<app>
  <div class="container">
    <div class="row">
      <div class="one-half column">
        <span>Page size:</span>
        <select name="pageSize" onchange={ pageSizeChanged }>
          <option value="20">20</option>
          <option value="30">30</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>|</span>
        <a href="#" onclick={ gotoPreviousPage }>Prev</a>
        <a href="#" onclick={ gotoNextPage }>Next</a>
        <span>|</span>
        <span>Current Page: { _currentPage }</span>
      </div>
      <div class="one-half column">
        <a class="button u-pull-right" href="auth/google/login">Login</a>
      </div>
    </div>

    <div class="row">
      <p if={ _error }>{ _error }</p>
      <table class="u-full-width">
        <thead>
          <tr>
            <th>Time</th>
            <th>Host</th>
            <th>Type</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          <tr each={ _pEvents }>
            <td>{ createdAt }</td>
            <td>{ host }</td>
            <td>{ msgType }</td>
            <td>{ message }</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script type="es6">
  import request from 'superagent/lib/client'
  
  this._pEvents = []
  this._currentPage = 1
  this._pageSize = 20
  this._error = null

  this.pageSizeChanged = (e) => {
    let oldSize = this._pageSize
    this._pageSize = parseInt(e.target.value)
    if (oldSize != this._pageSize) {
      this.loadEvents()
    }
  }

  this.gotoPreviousPage = () => {
    if (this._currentPage > 1) {
      this._currentPage--
      this.loadEvents()
    }
  }

  this.gotoNextPage = () => {
    this._currentPage++
    this.loadEvents()
  }

  this.on('mount', () => {
    this.loadEvents()
  })

  this.loadEvents = () => {
    let url = '/events?limit=' + this._pageSize
    let skip = this._pageSize * (this._currentPage - 1)
    url += '&skip=' + skip

    request.get(url).end((err, res) => {
      if (err) {
        this._error = 'Failed to get events, you might need to login. ' + err
        if (res.text) {
          this._error += ' | Error description: ' + res.text
        }
      } else {
        this._pEvents = res.body.results
      }
      this.update()
    })
  }
  </script>
</app>
